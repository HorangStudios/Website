<!DOCTYPE html>
<html lang="en">

<head>
	<title>HorangHill</title>
	<link rel="stylesheet" href="../../css/new.css">
	<link rel="icon" type="image/x-icon" href="logo.png">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="fontawesome.js" defer></script>

	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9451295160532565"
		crossorigin="anonymous"></script>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>
</head>

<body>
	<nav>
		<ul>
			<a href="index.html" style="float: left;"><img class="logo1" src="../../css\HorangHill.png"></img></a>
			<li style="float: left;"><a>HorangHill</a></li>

			<li><a href="index.html"><i class="fa-solid fa-home"></i> Home</a></li>
			<li><a href="publish.html"><i class="fa-solid fa-upload"></i> Publish</a></li>
			<li><a href="download.html"><i class="fa-solid fa-download"></i> Download</a></li>
			<li><a href="https://horanghill.createaforum.com/index.php"><i class="fa-solid fa-person"></i> Forum</a>
			</li>
			<li><a href="account.html"><i class="fa-solid fa-user"></i> Account</a></li>
		</ul>
	</nav>

	<header>
		<div id="form">
			<h1 style="text-shadow: 2px 2px 10px #000;" id="greetings">Loading games...</h1><br>

			<div style="display: flex; width: 100%; overflow: auto;">
				<div class="quickcard">
					<a href="publish.html">
						<h3>Publish</h3>
					</a>
					<div class="author">Publish a game</div>
				</div>

				<div class="quickcard">
					<a href="download.html">
						<h3>Download</h3>
					</a>
					<div class="author">Download the editor</div>
				</div>

				<div class="quickcard">
					<a href="https://horanghill.createaforum.com/index.php">
						<h3>Forum</h3>
					</a>
					<div class="author">Talk with the community</div>
				</div>

				<div class="quickcard">
					<a href="#greetings" onclick="firebase.auth().signOut(); window.location.replace('../index.html')">
						<h3>Log out</h3>
					</a>
					<div class="author">Log out from your account</div>
				</div>

			</div>
		</div>
	</header>

	<section style="height: fit-content; display: none;" id="main">
		<div id="gamelist" class="cardholder"></div>
	</section>

	<script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-database.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-auth.js"></script>
	<script>
		// Initialize Firebase
		const firebaseConfig = {
			apiKey: "AIzaSyDE-mQcJoquJxLrHAcS1kZbpjUbHYQmzsE",
			authDomain: "horanghill.firebaseapp.com",
			databaseURL: "https://horanghill-default-rtdb.firebaseio.com",
			projectId: "horanghill",
			storageBucket: "horanghill.appspot.com",
			messagingSenderId: "710235265347",
			appId: "1:710235265347:web:37fb53fe0bb9c4ecdab7f6",
			measurementId: "G-S1JMDFPGL0"
		};
		firebase.initializeApp(firebaseConfig);
		var database = firebase.database();
		var gamescontainer = document.getElementById('gamelist');

		//greetings time
		let today = new Date();
		let hour = today.getHours();
		let greetings
		if (hour >= 5 && hour < 12) {
			greetings = ("<i class='fa-solid fa-sun'></i> Good morning");
		} else if (hour >= 12 && hour < 18) {
			greetings = ("<i class='fa-regular fa-sun'></i> Good afternoon");
		} else {
			greetings = ("<i class='fa-solid fa-sun'></i> Good evening");
		}

		function truncate(str, num) {
			if (str.length > num) {
				return str.slice(0, num) + "...";
			} else {
				return str;
			}
		}

		database.ref('games').on('value', function (snapshot) {
			document.getElementById('main').style.display = "block"
			gamescontainer.innerHTML = '';
			var displayName = firebase.auth().currentUser.displayName || "Player";
			document.getElementById('greetings').innerHTML = `${greetings}, ${displayName}!`

			let games = snapshot.val();

			Object.keys(games).forEach(function (gameId) {
				var game = games[gameId];

				var card = document.createElement('div');
				card.id = 'game';
				gamename = "<div id='gamecard1'><h4>" + game.title + "</h4>" + game.createdBy + "</div>";
				gamedetails = "<div id='gamecard2'>" + truncate(game.desc, 100) + "</div>"
				card.innerHTML = gamedetails + gamename;
				card.style.backgroundImage = "url(" + game.thumbnail + ")";

				card.onclick = function () {
					window.location.href = ("details.html?id=" + gameId);
				}

				gamescontainer.prepend(card);
			});
		});
	</script>
</body>

</html>